Issue #135: Fix: Issue #47- remove "not Null" for GUIDHash and teleTANHash
URL: https://github.com/corona-warn-app/cwa-verification-server/pull/135

Commit ID: c6a3d65049304f768700affdbcbbb3c32aeb0832

Commit Message: Merge branch 'master' into fix/architecture-documentation

Files Changed (7):
File: pom.xml ======================
    - Additions: 5
    - Deletions: 0
=======================================================

    +++Added (new line 130):     <dependency>
    +++Added (new line 131):       <groupId>io.github.openfeign</groupId>
    +++Added (new line 132):       <artifactId>feign-httpclient</artifactId>
    +++Added (new line 133):       <version>11.0</version>
    +++Added (new line 134):     </dependency>

File: src/main/java/app/coronawarn/verification/client/TestResultServerClient.java ======================
    - Additions: 3
    - Deletions: 3
=======================================================

    ---Removed (old line 33): @FeignClient(name = "labServerService", url = "${uri.endpoint.labserver}")
    ---Removed (old line 34): public interface LabServerClient {
    +++Added (new line 33): @FeignClient(name = "labServerService", url = "${cwa-testresult-server.url}")
    +++Added (new line 34): public interface TestResultServerClient {
    ---Removed (old line 40):   @PostMapping(value = "/api/v1/app/result",
    +++Added (new line 40):   @PostMapping(value = "${cwa-testresult-server.path}",

File: src/main/java/app/coronawarn/verification/client/TestResultServerClientConfiguration.java ======================
    - Additions: 57
    - Deletions: 0
=======================================================

    +++Added (new line 1): package app.coronawarn.verification.client;
    +++Added (new line 2): 
    +++Added (new line 3): import feign.Client;
    +++Added (new line 4): import javax.net.ssl.SSLContext;
    +++Added (new line 5): import javax.net.ssl.SSLSocketFactory;
    +++Added (new line 6): import org.apache.http.conn.ssl.NoopHostnameVerifier;
    +++Added (new line 7): import org.apache.http.ssl.SSLContextBuilder;
    +++Added (new line 8): import org.springframework.beans.factory.annotation.Autowired;
    +++Added (new line 9): import org.springframework.context.annotation.Bean;
    +++Added (new line 10): import org.springframework.core.env.Environment;
    +++Added (new line 11): import org.springframework.util.ResourceUtils;
    +++Added (new line 12): 
    +++Added (new line 13): 
    +++Added (new line 14): public class TestResultServerClientConfiguration {
    +++Added (new line 15): 
    +++Added (new line 16):   @Autowired
    +++Added (new line 17):   Environment environment;
    +++Added (new line 18): 
    +++Added (new line 19):   /**
    +++Added (new line 20):    * Creates a feign client.
    +++Added (new line 21):    * @return default feign client with mTLS configuration if enabled.
    +++Added (new line 22):    */
    +++Added (new line 23):   @Bean
    +++Added (new line 24):   public Client feignClient() {
    +++Added (new line 25):     boolean isMutualAuthEnabled = Boolean.parseBoolean(
    +++Added (new line 26):       environment.getProperty("cwa-testresult-server.ssl.two-way-authentication-enabled"));
    +++Added (new line 27):     if (isMutualAuthEnabled) {
    +++Added (new line 28):       return new Client.Default(getSslSocketFactory(), new NoopHostnameVerifier());
    +++Added (new line 29):     } else {
    +++Added (new line 30):       return new Client.Default(null, new NoopHostnameVerifier());
    +++Added (new line 31):     }
    +++Added (new line 32): 
    +++Added (new line 33):   }
    +++Added (new line 34): 
    +++Added (new line 35):   private SSLSocketFactory getSslSocketFactory() {
    +++Added (new line 36):     try {
    +++Added (new line 37):       String keyStorePath = environment.getProperty("cwa-testresult-server.ssl.key-store");
    +++Added (new line 38):       String keyStorePassword = environment
    +++Added (new line 39):         .getProperty("cwa-testresult-server.ssl.key-store-password");
    +++Added (new line 40):       String keyPassword = environment.getProperty("cwa-testresult-server.ssl.key-password");
    +++Added (new line 41): 
    +++Added (new line 42):       String trustStorePath = environment.getProperty("cwa-testresult-server.ssl.trust-store");
    +++Added (new line 43):       String trustStorePassword = environment
    +++Added (new line 44):         .getProperty("cwa-testresult-server.ssl.trust-store-password");
    +++Added (new line 45): 
    +++Added (new line 46):       SSLContext sslContext = SSLContextBuilder
    +++Added (new line 47):         .create()
    +++Added (new line 48):         .loadKeyMaterial(ResourceUtils.getFile(keyStorePath), keyStorePassword.toCharArray(),
    +++Added (new line 49):           keyPassword.toCharArray())
    +++Added (new line 50):         .loadTrustMaterial(ResourceUtils.getFile(trustStorePath), trustStorePassword.toCharArray())
    +++Added (new line 51):         .build();
    +++Added (new line 52):       return sslContext.getSocketFactory();
    +++Added (new line 53):     } catch (Exception exception) {
    +++Added (new line 54):       throw new RuntimeException(exception);
    +++Added (new line 55):     }
    +++Added (new line 56):   }
    +++Added (new line 57): }

File: src/main/java/app/coronawarn/verification/service/LabServerService.java ======================
    - Additions: 3
    - Deletions: 3
=======================================================

    ---Removed (old line 24): import app.coronawarn.verification.client.LabServerClient;
    +++Added (new line 24): import app.coronawarn.verification.client.TestResultServerClient;
    ---Removed (old line 41):   private final LabServerClient labServerClient;
    +++Added (new line 41):   private final TestResultServerClient testResultServerClient;
    ---Removed (old line 49):     return labServerClient.result(guid);
    +++Added (new line 49):     return testResultServerClient.result(guid);

File: src/main/resources/application-cloud.yml ======================
    - Additions: 29
    - Deletions: 0
=======================================================

    +++Added (new line 9): 
    +++Added (new line 10): server:
    +++Added (new line 11):   ssl:
    +++Added (new line 12):     enabled: true
    +++Added (new line 13):     key-password: ${SSL_KEYSTORE_PASSWORD}
    +++Added (new line 14):     key-store: ${SSL_KEYSTORE_PATH}
    +++Added (new line 15):     key-store-password: ${SSL_KEYSTORE_PASSWORD}
    +++Added (new line 16):     key-store-provider: SUN
    +++Added (new line 17):     key-store-type: JKS
    +++Added (new line 18): 
    +++Added (new line 19): cwa-testresult-server:
    +++Added (new line 20):   ssl:
    +++Added (new line 21):     one-way-authentication-enabled: false
    +++Added (new line 22):     two-way-authentication-enabled: true
    +++Added (new line 23):     key-password: ${SSL_KEYSTORE_PASSWORD}
    +++Added (new line 24):     key-store: ${SSL_KEYSTORE_PATH}
    +++Added (new line 25):     key-store-password: ${SSL_KEYSTORE_PASSWORD}
    +++Added (new line 26):     key-store-provider: SUN
    +++Added (new line 27):     key-store-type: JKS
    +++Added (new line 28):     trust-store: ${SSL_CLIENT_TRUSTSTORE_PATH}
    +++Added (new line 29):     trust-store-password: ${SSL_TRUSTSTORE_PASSWORD}
    +++Added (new line 30): 
    +++Added (new line 31): feign:
    +++Added (new line 32):   client:
    +++Added (new line 33):     config:
    +++Added (new line 34):       default:
    +++Added (new line 35):         connectTimeout: 5000
    +++Added (new line 36):         readTimeout: 5000
    +++Added (new line 37):         loggerLevel: full

File: src/main/resources/application.yml ======================
    - Additions: 8
    - Deletions: 3
=======================================================

    ---Removed (old line 62): uri:
    ---Removed (old line 63):   endpoint:
    ---Removed (old line 64):     labserver: http://localhost:8088
    +++Added (new line 66): 
    +++Added (new line 67): cwa-testresult-server:
    +++Added (new line 68):   url: http://localhost:8088
    +++Added (new line 69):   path:
    +++Added (new line 70):     result: /api/v1/app/result
    +++Added (new line 71):   ssl:
    +++Added (new line 72):     one-way-authentication-enabled: false
    +++Added (new line 73):     two-way-authentication-enabled: false

File: src/test/java/app/coronawarn/verification/service/LabServerServiceTest.java ======================
    - Additions: 3
    - Deletions: 3
=======================================================

    ---Removed (old line 26): import app.coronawarn.verification.client.LabServerClient;
    +++Added (new line 26): import app.coronawarn.verification.client.TestResultServerClient;
    ---Removed (old line 50):     labServerService = new LabServerService(new LabServerClientMock());
    +++Added (new line 50):     labServerService = new LabServerService(new TestResultServerClientMock());
    ---Removed (old line 71):   public static class LabServerClientMock implements LabServerClient {
    +++Added (new line 71):   public static class TestResultServerClientMock implements TestResultServerClient {

