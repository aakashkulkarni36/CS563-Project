Issue #249: Fix: Add Unique Constraint to HashedGuid Property
URL: https://github.com/corona-warn-app/cwa-verification-server/pull/249

Commit ID: c0dbc464a7c92bde006400e9b2db145c02169ecc

Commit Message: Add Unique Constraint to HashedGuid Property

Files Changed (4):
File: src/main/java/app/coronawarn/verification/service/AppSessionService.java ======================
    - Additions: 10
    - Deletions: 1
=======================================================

    +++Added (new line 25): import app.coronawarn.verification.exception.VerificationServerException;
    +++Added (new line 37): import org.springframework.dao.DataIntegrityViolationException;
    ---Removed (old line 106):     saveAppSession(appSession);
    +++Added (new line 108): 
    +++Added (new line 109):     try {
    +++Added (new line 110):       saveAppSession(appSession);
    +++Added (new line 111):     } catch (DataIntegrityViolationException e) {
    +++Added (new line 112):       log.error("Failed to save RegistrationToken because of Hashed GUID Conflict: {}", hashedGuid);
    +++Added (new line 113):       throw new VerificationServerException(
    +++Added (new line 114):         HttpStatus.BAD_REQUEST, "Failed to save RegistrationToken because of Hashed GUID Conflict");
    +++Added (new line 115):     }

File: src/main/resources/db/changelog.yml ======================
    - Additions: 3
    - Deletions: 0
=======================================================

    +++Added (new line 14):   - include:
    +++Added (new line 15):       file: changelog/v003-add-unique-hashed-guid.yml
    +++Added (new line 16):       relativeToChangelogFile: true

File: src/main/resources/db/changelog/v003-add-unique-hashed-guid.yml ======================
    - Additions: 8
    - Deletions: 0
=======================================================

    +++Added (new line 1): databaseChangeLog:
    +++Added (new line 2):   - changeSet:
    +++Added (new line 3):       id: add-unique-hashed-guid
    +++Added (new line 4):       author: f11h
    +++Added (new line 5):       changes:
    +++Added (new line 6):         - addUniqueConstraint:
    +++Added (new line 7):             tableName: app_session
    +++Added (new line 8):             columnNames: hashed_guid, hashed_guid_dob

File: src/test/java/app/coronawarn/verification/service/EntitiesCleanupServiceTest.java ======================
    - Additions: 4
    - Deletions: 6
=======================================================

    +++Added (new line 32): import java.time.LocalDateTime;
    +++Added (new line 33): import java.time.Period;
    +++Added (new line 34): import java.util.Optional;
    +++Added (new line 35): import java.util.concurrent.TimeUnit;
    ---Removed (old line 41): import org.springframework.test.context.junit4.SpringRunner;
    ---Removed (old line 44): import java.time.LocalDateTime;
    ---Removed (old line 45): import java.time.Period;
    ---Removed (old line 46): import java.util.Optional;
    ---Removed (old line 47): import java.util.concurrent.TimeUnit;
    ---Removed (old line 48): 

